<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VS Code Web Clone with Monaco & Full UI</title>

<!-- VS Code font -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet" />

<!-- Monaco Editor CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs/loader.min.js"></script>

<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    font-family: 'Fira Code', Consolas, monospace, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: #cccccc;
    user-select: none;
    overflow: hidden;
  }

  /* Layout */
  #app {
    display: flex;
    height: 100vh;
    width: 100vw;
  }

  /* Sidebar (left) */
  #sidebar {
    width: 48px;
    background-color: #252526;
    border-right: 1px solid #333333;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
  }

  #sidebar button {
    width: 40px;
    height: 40px;
    margin: 6px 0;
    background: transparent;
    border: none;
    color: #cccccc;
    font-size: 24px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    position: relative;
  }
  #sidebar button:hover {
    background-color: #333333;
    color: white;
  }
  #sidebar button.active {
    background-color: #007acc;
    color: white;
  }
  /* Tooltip on hover */
  #sidebar button[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 48px;
    top: 50%;
    transform: translateY(-50%);
    background: #333;
    color: #fff;
    padding: 4px 8px;
    border-radius: 2px;
    white-space: nowrap;
    font-size: 12px;
    pointer-events: none;
    user-select: none;
    z-index: 999;
  }

  /* Panels container (right of sidebar) */
  #panels {
    width: 280px;
    background-color: #1e1e1e;
    border-right: 1px solid #333333;
    display: flex;
    flex-direction: column;
  }

  .panel {
    flex-grow: 1;
    display: none;
    overflow-y: auto;
    padding: 12px;
    font-size: 14px;
  }
  .panel.active {
    display: block;
  }

  .panel header {
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.05em;
    color: #cccccc;
    margin-bottom: 12px;
    user-select: none;
  }

  /* File Explorer list */
  #file-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #file-list li {
    padding: 6px 10px;
    border-radius: 3px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #cccccc;
  }
  #file-list li:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  #file-list li.active {
    background-color: #007acc;
    color: white;
    font-weight: 600;
  }
  #file-list li button.delete-btn {
    background: none;
    border: none;
    color: #888888;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
  }
  #file-list li button.delete-btn:hover {
    color: #e81123;
  }

  /* New file input and button */
  #new-file-container {
    display: flex;
    margin-top: 12px;
    gap: 8px;
  }
  #new-file-name {
    flex-grow: 1;
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #cccccc;
    font-size: 14px;
    outline: none;
  }
  #new-file-name::placeholder {
    color: #777777;
  }
  #btn-new-file {
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-new-file:hover {
    background-color: #005f9e;
  }

  /* Search panel */
  #search-input {
    width: 100%;
    padding: 6px 8px;
    border-radius: 3px;
    border: 1px solid #333333;
    background-color: #252526;
    color: #ccc;
    font-size: 14px;
    outline: none;
  }
  #search-results {
    list-style: none;
    margin: 8px 0 0 0;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
  }
  #search-results li {
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 3px;
    font-size: 13px;
    color: #ccc;
  }
  #search-results li:hover {
    background-color: #333333;
    color: white;
  }

  /* Run panel */
  #btn-run-code {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 8px;
    font-size: 14px;
  }
  #btn-run-code:hover {
    background-color: #005f9e;
  }
  #run-iframe {
    width: 100%;
    height: 300px;
    border: 1px solid #333333;
    border-radius: 4px;
    background: white;
  }

  /* Extensions and Settings panel placeholder */
  #extension-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #extension-list li {
    padding: 8px;
    border-radius: 3px;
    cursor: pointer;
    border: 1px solid #333333;
    margin-bottom: 6px;
  }
  #extension-list li:hover {
    background-color: #333333;
    color: white;
  }
  #settings-form label {
    display: block;
    margin-bottom: 10px;
    font-size: 14px;
  }
  #settings-form select, #settings-form input {
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #ccc;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
    outline: none;
  }
  #btn-reset-settings {
    margin-top: 12px;
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-reset-settings:hover {
    background-color: #005f9e;
  }

  /* Main content area */
  #main-area {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  /* Tabs */
  #tab-bar {
    height: 36px;
    background-color: #252526;
    display: flex;
    align-items: center;
    overflow-x: auto;
    border-bottom: 1px solid #333333;
  }
  #tab-bar::-webkit-scrollbar {
    height: 8px;
  }
  #tab-bar::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
  }
  .tab {
    user-select: none;
    padding: 6px 14px;
    margin: 0 2px;
    font-size: 14px;
    color: #cccccc;
    background-color: #252526;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  .tab.active {
    background-color: #1e1e1e;
    color: white;
    border-bottom: 2px solid #007acc;
  }
  .tab:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  .tab .close-btn {
    margin-left: 10px;
    font-weight: bold;
    color: #888888;
    cursor: pointer;
  }
  .tab .close-btn:hover {
    color: #e81123;
  }

  /* Monaco editor container */
  #editor-container {
    flex-grow: 1;
    position: relative;
  }
  #editor {
    width: 100%;
    height: 100%;
  }

  /* Status bar */
  #status-bar {
    height: 24px;
    background-color: #007acc;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    padding: 0 12px;
    user-select: none;
  }

  /* PS5 insert buttons */
  #ps5-buttons {
    position: absolute;
    bottom: 36px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 10;
  }
  #ps5-buttons button {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.15s ease-in-out;
  }
  #ps5-buttons button:hover {
    background-color: #005f9e;
  }

  /* Force Type Mode Button */
  #btn-force-type {
    position: absolute;
    bottom: 80px;
    right: 20px;
    background-color: #e81123;
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    z-index: 11;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-force-type:hover {
    background-color: #b50d18;
  }
</style>
</head>
<body>

<div id="app" role="main">

  <nav id="sidebar" aria-label="Sidebar">
    <button id="btn-explorer" class="active" data-tooltip="Explorer" aria-pressed="true" aria-label="Explorer">üìÅ</button>
    <button id="btn-search" data-tooltip="Search" aria-pressed="false" aria-label="Search">üîç</button>
    <button id="btn-run" data-tooltip="Run and Debug" aria-pressed="false" aria-label="Run and Debug">‚ñ∂Ô∏è</button>
    <button id="btn-extensions" data-tooltip="Extensions" aria-pressed="false" aria-label="Extensions">üß©</button>
    <button id="btn-settings" data-tooltip="Settings" aria-pressed="false" aria-label="Settings">‚öôÔ∏è</button>
  </nav>

  <section id="panels" aria-label="Panels">
    <!-- Explorer -->
    <section id="panel-explorer" class="panel active" role="region" aria-label="Explorer Panel">
      <header>EXPLORER</header>
      <ul id="file-list" role="list" aria-label="Files"></ul>
      <div id="new-file-container">
        <input type="text" id="new-file-name" placeholder="New file name..." aria-label="New file name" />
        <button id="btn-new-file" aria-label="Add new file">Add</button>
      </div>
    </section>

    <!-- Search -->
    <section id="panel-search" class="panel" role="region" aria-label="Search Panel">
      <header>SEARCH</header>
      <input id="search-input" type="search" placeholder="Search in files..." aria-label="Search in files" />
      <ul id="search-results" role="list" aria-label="Search Results"></ul>
    </section>

    <!-- Run -->
    <section id="panel-run" class="panel" role="region" aria-label="Run and Debug Panel">
      <header>RUN AND DEBUG</header>
      <button id="btn-run-code" aria-label="Run code">Run Code</button>
      <iframe id="run-iframe" sandbox="allow-scripts allow-same-origin" title="Run code output"></iframe>
    </section>

    <!-- Extensions -->
    <section id="panel-extensions" class="panel" role="region" aria-label="Extensions Panel">
      <header>EXTENSIONS</header>
      <ul id="extension-list">
        <li>Extension Marketplace (Coming Soon)</li>
      </ul>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="panel" role="region" aria-label="Settings Panel">
      <header>SETTINGS</header>
      <form id="settings-form">
        <label for="setting-theme">Theme:
          <select id="setting-theme" name="setting-theme" aria-label="Select theme">
            <option value="vs-dark" selected>Dark</option>
            <option value="vs-light">Light</option>
          </select>
        </label>
        <label for="setting-fontsize">Font Size:
          <input type="number" id="setting-fontsize" name="setting-fontsize" min="8" max="40" step="1" value="14" aria-label="Editor font size" />
        </label>
        <button type="button" id="btn-reset-settings">Reset Settings</button>
      </form>
    </section>
  </section>

  <main id="main-area" aria-label="Main editor area">
    <div id="tab-bar" role="tablist" aria-label="Open Files Tabs"></div>
    <div id="editor-container">
      <div id="editor" aria-label="Code Editor"></div>
      <div id="ps5-buttons" aria-label="PS5 insert buttons">
        <button id="btn-insert-tab" aria-label="Insert tab">Insert Tab</button>
        <button id="btn-insert-newline" aria-label="Insert newline">Insert Newline</button>
      </div>
      <button id="btn-force-type" aria-label="Force Type Mode">Force Type Mode</button>
    </div>
    <footer id="status-bar" role="contentinfo" aria-live="polite">
      <span id="status-message">Ready</span>
      <span id="status-position">Ln 1, Col 1</span>
    </footer>
  </main>
</div>

<script>
  // Load Monaco Editor with AMD loader
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    // State
    const state = {
      files: {
        'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Page</title>
</head>
<body>
  <h1>Hello World</h1>
</body>
</html>`,
        'style.css': `body { background-color: #121212; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }`,
        'script.js': `console.log('Hello from JS!');`
      },
      openTabs: ['index.html'],
      activeFile: 'index.html',
      unsavedFiles: new Set(),
      currentPanel: 'explorer',
      settings: {
        theme: 'vs-dark',
        fontSize: 14,
      },
    };

    // Elements
    const sidebarButtons = document.querySelectorAll('#sidebar button');
    const panels = {
      explorer: document.getElementById('panel-explorer'),
      search: document.getElementById('panel-search'),
      run: document.getElementById('panel-run'),
      extensions: document.getElementById('panel-extensions'),
      settings: document.getElementById('panel-settings'),
    };
    const fileListEl = document.getElementById('file-list');
    const newFileNameInput = document.getElementById('new-file-name');
    const btnNewFile = document.getElementById('btn-new-file');
    const tabBar = document.getElementById('tab-bar');
    const statusMessage = document.getElementById('status-message');
    const statusPosition = document.getElementById('status-position');
    const searchInput = document.getElementById('search-input');
    const searchResults = document.getElementById('search-results');
    const btnRunCode = document.getElementById('btn-run-code');
    const runIframe = document.getElementById('run-iframe');
    const settingThemeSelect = document.getElementById('setting-theme');
    const settingFontSizeInput = document.getElementById('setting-fontsize');
    const btnResetSettings = document.getElementById('btn-reset-settings');
    const btnInsertTab = document.getElementById('btn-insert-tab');
    const btnInsertNewline = document.getElementById('btn-insert-newline');
    const btnForceType = document.getElementById('btn-force-type');

    // Monaco editor instance
    let editor = monaco.editor.create(document.getElementById('editor'), {
      value: state.files[state.activeFile],
      language: getLanguageFromFile(state.activeFile),
      theme: state.settings.theme,
      fontSize: state.settings.fontSize,
      automaticLayout: true,
      minimap: { enabled: false },
      scrollbar: { verticalScrollbarSize: 8, horizontalScrollbarSize: 8 }
    });

    // Helper: get language from file extension
    function getLanguageFromFile(filename) {
      if (filename.endsWith('.html')) return 'html';
      if (filename.endsWith('.css')) return 'css';
      if (filename.endsWith('.js')) return 'javascript';
      if (filename.endsWith('.json')) return 'json';
      if (filename.endsWith('.ts')) return 'typescript';
      if (filename.endsWith('.py')) return 'python';
      return 'plaintext';
    }

    // Switch panel
    sidebarButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        sidebarButtons.forEach(b => {
          b.classList.remove('active');
          b.setAttribute('aria-pressed', 'false');
        });
        btn.classList.add('active');
        btn.setAttribute('aria-pressed', 'true');
        const id = btn.id.replace('btn-', '');
        state.currentPanel = id;
        Object.keys(panels).forEach(key => {
          if (key === id) {
            panels[key].classList.add('active');
          } else {
            panels[key].classList.remove('active');
          }
        });
      });
    });

    // Render file list
    function renderFileList() {
      fileListEl.innerHTML = '';
      Object.keys(state.files).forEach(filename => {
        const li = document.createElement('li');
        li.textContent = filename;
        li.setAttribute('role', 'listitem');
        li.tabIndex = 0;
        if (filename === state.activeFile) {
          li.classList.add('active');
        }
        li.addEventListener('click', () => openFile(filename));
        li.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openFile(filename);
          }
        });

        // Delete button
        const delBtn = document.createElement('button');
        delBtn.textContent = '√ó';
        delBtn.className = 'delete-btn';
        delBtn.title = `Delete ${filename}`;
        delBtn.addEventListener('click', e => {
          e.stopPropagation();
          if (confirm(`Delete file "${filename}"?`)) {
            delete state.files[filename];
            if (state.activeFile === filename) {
              const files = Object.keys(state.files);
              state.activeFile = files.length ? files[0] : null;
              if (state.activeFile) openFile(state.activeFile);
              else {
                editor.setValue('');
                updateTabBar();
              }
            }
            renderFileList();
          }
        });
        li.appendChild(delBtn);

        fileListEl.appendChild(li);
      });
    }

    // Open file
    function openFile(filename) {
      if (!state.files[filename]) return;
      state.activeFile = filename;
      editor.setValue(state.files[filename]);
      const lang = getLanguageFromFile(filename);
      monaco.editor.setModelLanguage(editor.getModel(), lang);
      updateTabBar();
      updateStatus('File opened: ' + filename);
    }

    // Add new file
    btnNewFile.addEventListener('click', () => {
      const name = newFileNameInput.value.trim();
      if (!name) {
        alert('Enter a valid file name');
        return;
      }
      if (state.files[name]) {
        alert('File already exists');
        return;
      }
      state.files[name] = '';
      renderFileList();
      openFile(name);
      newFileNameInput.value = '';
    });

    // Update tab bar
    function updateTabBar() {
      tabBar.innerHTML = '';
      Object.keys(state.files).forEach(filename => {
        const tab = document.createElement('div');
        tab.className = 'tab' + (filename === state.activeFile ? ' active' : '');
        tab.textContent = filename;
        tab.tabIndex = 0;

        tab.addEventListener('click', () => openFile(filename));
        tab.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openFile(filename);
          }
        });

        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-btn';
        closeBtn.textContent = '√ó';
        closeBtn.title = `Close ${filename}`;
        closeBtn.addEventListener('click', e => {
          e.stopPropagation();
          delete state.files[filename];
          if (state.activeFile === filename) {
            const files = Object.keys(state.files);
            state.activeFile = files.length ? files[0] : null;
            if (state.activeFile) openFile(state.activeFile);
            else editor.setValue('');
          }
          renderFileList();
          updateTabBar();
        });
        tab.appendChild(closeBtn);

        tabBar.appendChild(tab);
      });
    }

    // Update status bar message
    function updateStatus(msg) {
      statusMessage.textContent = msg;
    }

    // Update status bar cursor position
    editor.onDidChangeCursorPosition(e => {
      const pos = e.position;
      statusPosition.textContent = `Ln ${pos.lineNumber}, Col ${pos.column}`;
    });

    // Save content on editor change
    editor.onDidChangeModelContent(() => {
      if (!state.activeFile) return;
      state.files[state.activeFile] = editor.getValue();
      state.unsavedFiles.add(state.activeFile);
      updateStatus(`Editing ${state.activeFile} (Unsaved)`);
      updateTabBar();
    });

    // Run code in iframe
    btnRunCode.addEventListener('click', () => {
      if (!state.activeFile) {
        alert('Open a file to run');
        return;
      }
      if (!state.activeFile.endsWith('.html')) {
        alert('Only HTML files can be run');
        return;
      }
      const code = editor.getValue();
      runIframe.srcdoc = code;
      updateStatus('Running ' + state.activeFile);
    });

    // Insert Tab button for PS5
    btnInsertTab.addEventListener('click', () => {
      editor.trigger('keyboard', 'type', { text: '\t' });
      editor.focus();
    });

    // Insert Newline button for PS5
    btnInsertNewline.addEventListener('click', () => {
      editor.trigger('keyboard', 'type', { text: '\n' });
      editor.focus();
    });

    // Settings change handlers
    settingThemeSelect.addEventListener('change', () => {
      const theme = settingThemeSelect.value;
      state.settings.theme = theme;
      monaco.editor.setTheme(theme);
    });

    settingFontSizeInput.addEventListener('change', () => {
      const size = parseInt(settingFontSizeInput.value, 10);
      if (size >= 8 && size <= 40) {
        state.settings.fontSize = size;
        editor.updateOptions({ fontSize: size });
      }
    });

    // Reset settings
    btnResetSettings.addEventListener('click', () => {
      state.settings = { theme: 'vs-dark', fontSize: 14 };
      settingThemeSelect.value = state.settings.theme;
      settingFontSizeInput.value = state.settings.fontSize;
      monaco.editor.setTheme(state.settings.theme);
      editor.updateOptions({ fontSize: state.settings.fontSize });
    });

    // Search functionality (basic)
    searchInput.addEventListener('input', () => {
      const query = searchInput.value.toLowerCase();
      searchResults.innerHTML = '';
      if (!query) return;
      Object.entries(state.files).forEach(([filename, content]) => {
        if (content.toLowerCase().includes(query)) {
          const li = document.createElement('li');
          li.textContent = filename;
          li.tabIndex = 0;
          li.addEventListener('click', () => openFile(filename));
          searchResults.appendChild(li);
        }
      });
    });

    // Force Type Mode button: cancel rename and focus editor
    btnForceType.addEventListener('click', () => {
      const renameController = editor.getContribution('editor.contrib.renameController');
      if (renameController && renameController._widget) {
        renameController._widget.cancel();
      }
      editor.focus();
      updateStatus('Forced editor focus and exited rename mode');
    });

    // Initial render
    renderFileList();
    updateTabBar();
  });
</script>

</body>
</html>