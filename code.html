<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VS Code Web Editor (Dark Theme + Firebase Save/Load)</title>
<style>
  /* Reset */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0; height: 100%;
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: #d4d4d4;
    overflow: hidden;
  }
  /* Layout container */
  #app {
    display: flex;
    height: 100vh;
    width: 100vw;
  }
  /* Sidebar - Explorer */
  #sidebar {
    width: 240px;
    background-color: #252526;
    display: flex;
    flex-direction: column;
    border-right: 1px solid #333;
    user-select: none;
  }
  #sidebar header {
    font-weight: 600;
    font-size: 14px;
    padding: 12px 16px;
    border-bottom: 1px solid #333;
    color: #ccc;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  #file-explorer {
    flex: 1;
    overflow-y: auto;
    padding: 10px 0;
  }
  ul.file-list {
    list-style: none;
    margin: 0; padding: 0;
  }
  ul.file-list li {
    padding: 6px 12px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    border-radius: 3px;
  }
  ul.file-list li:hover:not(.active) {
    background-color: #333333;
  }
  ul.file-list li.active {
    background-color: #094771;
    color: white;
  }
  ul.file-list li button.delete-file {
    background: transparent;
    border: none;
    color: #888;
    font-weight: 700;
    font-size: 14px;
    cursor: pointer;
    padding: 0 4px;
  }
  ul.file-list li button.delete-file:hover {
    color: #e81123;
  }
  #new-file-container {
    padding: 10px 16px;
    border-top: 1px solid #333;
  }
  #new-file-container input {
    width: calc(100% - 80px);
    padding: 6px 8px;
    font-size: 13px;
    border: none;
    border-radius: 3px;
  }
  #new-file-container button {
    width: 60px;
    margin-left: 8px;
    padding: 6px 0;
    background-color: #0e639c;
    border: none;
    color: white;
    border-radius: 3px;
    font-size: 13px;
    cursor: pointer;
  }
  #new-file-container button:hover {
    background-color: #1177cc;
  }

  /* Add Save/Load buttons container */
  #save-load-container {
    display: flex;
    justify-content: space-around;
    padding: 8px 16px;
    border-top: 1px solid #333;
    background: #1e1e1e;
  }
  #save-load-container button {
    flex: 1;
    margin: 0 5px;
    background-color: #0e639c;
    border: none;
    color: white;
    border-radius: 3px;
    font-size: 13px;
    cursor: pointer;
    padding: 6px 0;
  }
  #save-load-container button:hover {
    background-color: #1177cc;
  }

  /* Main editor area */
  #main-area {
    flex: 1;
    display: flex;
    flex-direction: column;
    background-color: #1e1e1e;
  }

  /* Tabs bar */
  #tab-bar {
    height: 38px;
    background-color: #252526;
    border-bottom: 1px solid #333;
    display: flex;
    align-items: center;
    padding-left: 10px;
    overflow-x: auto;
    scrollbar-width: none; /* Firefox */
  }
  #tab-bar::-webkit-scrollbar {
    display: none; /* Chrome */
  }
  .tab {
    display: flex;
    align-items: center;
    background-color: #2d2d2d;
    color: #ccc;
    padding: 6px 12px;
    margin-right: 2px;
    font-size: 13px;
    border-top-left-radius: 3px;
    border-top-right-radius: 3px;
    cursor: pointer;
    user-select: none;
    position: relative;
  }
  .tab.active {
    background-color: #1e1e1e;
    color: white;
    border-bottom: 1px solid #1e1e1e;
  }
  .tab:hover:not(.active) {
    background-color: #3c3c3c;
    color: white;
  }
  .tab .close-btn {
    margin-left: 8px;
    font-weight: 700;
    color: #888;
    cursor: pointer;
    font-size: 14px;
  }
  .tab .close-btn:hover {
    color: #e81123;
  }

  /* Editor container */
  #editor-container {
    flex: 1;
    position: relative;
  }
  textarea {
    width: 100%;
    height: 100%;
    background-color: #1e1e1e;
    border: none;
    color: #d4d4d4;
    font-family: Consolas, 'Courier New', monospace;
    font-size: 14px;
    line-height: 1.4;
    padding: 12px;
    resize: none;
    outline: none;
  }

  /* Status bar */
  #status-bar {
    height: 22px;
    background-color: #007acc;
    color: white;
    font-size: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0 12px;
    user-select: none;
  }

  /* PS5 Insert Buttons Overlay */
  #ps5-buttons {
    position: absolute;
    bottom: 40px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  #ps5-buttons button {
    background-color: #0e639c;
    border: none;
    color: white;
    padding: 6px 12px;
    border-radius: 3px;
    font-size: 14px;
    cursor: pointer;
  }
  #ps5-buttons button:hover {
    background-color: #1177cc;
  }
</style>
</head>
<body>

<div id="app">

  <!-- Sidebar -->
  <nav id="sidebar" aria-label="File Explorer">
    <header>EXPLORER</header>
    <div id="file-explorer">
      <ul class="file-list" id="file-list">
        <!-- Files will appear here -->
      </ul>
    </div>
    <div id="new-file-container">
      <input type="text" id="new-file-name" placeholder="New file name..." aria-label="New file name" />
      <button id="btn-add-file" aria-label="Add new file">Add</button>
    </div>
    <div id="save-load-container">
      <button id="btn-save-files" aria-label="Save files to Firebase">Save</button>
      <button id="btn-load-files" aria-label="Load files from Firebase">Load</button>
    </div>
  </nav>

  <!-- Main editor area -->
  <main id="main-area" role="main">
    <div id="tab-bar" role="tablist" aria-label="Open files">
      <!-- Tabs will be added here -->
    </div>
    <div id="editor-container">
      <!-- Single textarea for now -->
      <textarea id="code-editor" spellcheck="false" aria-label="Code editor"></textarea>

      <!-- PS5 buttons overlay -->
      <div id="ps5-buttons" aria-label="PS5 editor controls">
        <button id="btn-insert-tab" title="Insert Tab (2 spaces)">Tab</button>
        <button id="btn-insert-newline" title="Insert Newline">Newline</button>
      </div>
    </div>
    <footer id="status-bar" aria-live="polite">
      <div id="status-left">Ready</div>
      <div id="status-right">Ln 1, Col 1</div>
    </footer>
  </main>

</div>

<!-- Firebase SDK -->
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-database-compat.js"></script>

<script>
  // Your Firebase config here
  const firebaseConfig = {
    apiKey: "YOUR_API_KEY",
    authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
    databaseURL: "https://YOUR_PROJECT_ID-default-rtdb.firebaseio.com",
    projectId: "YOUR_PROJECT_ID",
    storageBucket: "YOUR_PROJECT_ID.appspot.com",
    messagingSenderId: "YOUR_SENDER_ID",
    appId: "YOUR_APP_ID"
  };

  // Initialize Firebase
  firebase.initializeApp(firebaseConfig);
  const database = firebase.database();

  // Elements
  const fileListEl = document.getElementById('file-list');
  const newFileNameInput = document.getElementById('new-file-name');
  const btnAddFile = document.getElementById('btn-add-file');
  const tabBar = document.getElementById('tab-bar');
  const codeEditor = document.getElementById('code-editor');
  const statusLeft = document.getElementById('status-left');
  const statusRight = document.getElementById('status-right');
  const btnSaveFiles = document.getElementById('btn-save-files');
  const btnLoadFiles = document.getElementById('btn-load-files');

  // Files data structure: { filename: { content, language } }
  const files = {};
  let openTabs = []; // filenames currently open in tabs
  let activeFile = null;

  // Helper: detect language by file extension
  function detectLanguage(filename) {
    if(filename.endsWith('.html')) return 'html';
    if(filename.endsWith('.css')) return 'css';
    if(filename.endsWith('.js')) return 'javascript';
    if(filename.endsWith('.py')) return 'python';
    return 'plaintext';
  }

  // Add a file to the files object and UI
  function addFile(name) {
    if(!name) {
      alert('Please enter a file name');
      return;
    }
    if(files[name]) {
      alert('File already exists');
      return;
    }
    files[name] = { content: '', language: detectLanguage(name) };
    renderFileList();
    openFile(name);
    newFileNameInput.value = '';
  }

  // Render file list in sidebar
  function renderFileList() {
    fileListEl.innerHTML = '';
    Object.keys(files).forEach(name => {
      const li = document.createElement('li');
      li.textContent = name;
      li.tabIndex = 0;
      li.setAttribute('role', 'button');
      if(name === activeFile) li.classList.add('active');

      // Click to open file
      li.onclick = () => openFile(name);
      li.onkeydown = e => { if(e.key === 'Enter' || e.key === ' ') openFile(name); };

      // Delete button
      const delBtn = document.createElement('button');
      delBtn.textContent = 'Ã—';
      delBtn.title = 'Delete file';
      delBtn.className = 'delete-file';
      delBtn.onclick = (e) => {
        e.stopPropagation();
        if(confirm(`Delete file "${name}"?`)) {
          closeFile(name);
          delete files[name];
          if(activeFile === name) {
            activeFile = null;
            if(Object.keys(files).length) openFile(Object.keys(files)[0]);
            else renderTabs();
          }
          renderFileList();
        }
      };
      li.appendChild(delBtn);

      fileListEl.appendChild(li);
    });
  }

  // Open a file (show tab + content)
  function openFile(name) {
    if(!files[name]) return;
    // Save current content before switching
    if(activeFile) {
      files[activeFile].content = codeEditor.value;
    }
    activeFile = name;
    if(!openTabs.includes(name)) openTabs.push(name);
    renderTabs();
    loadFileContent(name);
  }

  // Close file tab
  function closeFile(name) {
    // Save current if active
    if(activeFile === name) {
      files[name].content = codeEditor.value;
      activeFile = null;
    }
    openTabs = openTabs.filter(n => n !== name);
    renderTabs();
    if(!activeFile && openTabs.length) openFile(openTabs[0]);
  }

  // Render tabs bar
  function renderTabs() {
    tabBar.innerHTML = '';
    openTabs.forEach(name => {
      const tab = document.createElement('div');
      tab.className = 'tab' + (name === activeFile ? ' active' : '');
      tab.textContent = name;
      tab.title = name;

      // Clicking tab switches to file
      tab.onclick = () => openFile(name);

      // Close button on tab
      const closeBtn = document.createElement('span');
      closeBtn.className = 'close-btn';
      closeBtn.textContent = 'Ã—';
      closeBtn.title = 'Close file';
      closeBtn.onclick = (e) => {
        e.stopPropagation();
        closeFile(name);
      };
      tab.appendChild(closeBtn);

      tabBar.appendChild(tab);
    });
  }

  // Load file content into editor
  function loadFileContent(name) {
    codeEditor.value = files[name].content;
    updateStatusBar();
    codeEditor.focus();
  }

  // Update status bar line/col
  function updateStatusBar() {
    const pos = getCaretPosition(codeEditor);
    statusRight.textContent = `Ln ${pos.line}, Col ${pos.col}`;
  }
  // Get caret position helper
  function getCaretPosition(el) {
    const pos = el.selectionStart;
    const text = el.value.substr(0, pos);
    const lines = text.split('\n');
    return {
      line: lines.length,
      col: lines[lines.length - 1].length + 1
    };
  }

  // Insert Tab or Newline buttons for PS5
  document.getElementById('btn-insert-tab').onclick = () => {
    insertAtCursor(codeEditor, '  ');
  };
  document.getElementById('btn-insert-newline').onclick = () => {
    insertAtCursor(codeEditor, '\n');
  };

  // Insert text helper at cursor
  function insertAtCursor(textarea, text) {
    const start = textarea.selectionStart;
    const end = textarea.selectionEnd;
    const val = textarea.value;
    textarea.value = val.slice(0, start) + text + val.slice(end);
    textarea.selectionStart = textarea.selectionEnd = start + text.length;
    textarea.focus();
    updateStatusBar();
  }

  // Update status on cursor move or input
  codeEditor.addEventListener('keyup', updateStatusBar);
  codeEditor.addEventListener('click', updateStatusBar);

  // Add new file button
  btnAddFile.addEventListener('click', () => {
    addFile(newFileNameInput.value.trim());
  });
  newFileNameInput.addEventListener('keydown', e => {
    if(e.key === 'Enter') addFile(newFileNameInput.value.trim());
  });

  // Save files to Firebase
  btnSaveFiles.addEventListener('click', () => {
    if(activeFile) {
      files[activeFile].content = codeEditor.value;
    }
    const userKey = 'guestUser'; // Replace with actual user/session key if you want multi-user
    statusLeft.textContent = 'Saving...';
    firebase.database().ref(`editors/${userKey}/files`).set(files)
      .then(() => {
        statusLeft.textContent = 'Save successful!';
        setTimeout(() => { statusLeft.textContent = 'Ready'; }, 2000);
      })
      .catch((err) => {
        statusLeft.textContent = 'Save failed!';
        alert('Error saving files: ' + err.message);
      });
  });

  // Load files from Firebase
  btnLoadFiles.addEventListener('click', () => {
    const userKey = 'guestUser'; // Replace with actual user/session key
    statusLeft.textContent = 'Loading...';
    firebase.database().ref(`editors/${userKey}/files`).once('value')
      .then(snapshot => {
        const data = snapshot.val();
        if(!data) {
          alert('No saved files found.');
          statusLeft.textContent = 'Ready';
          return;
        }
        // Save current file content first
        if(activeFile) {
          files[activeFile].content = codeEditor.value;
        }
        // Replace files object
        for(let key in files) delete files[key]; // clear current
        for(let key in data) {
          files[key] = data[key];
        }
        // Reset tabs & open first file
        openTabs = Object.keys(files);
        if(openTabs.length) {
          openFile(openTabs[0]);
        } else {
          activeFile = null;
          codeEditor.value = '';
          renderTabs();
        }
        renderFileList();
        statusLeft.textContent = 'Load successful!';
        setTimeout(() => { statusLeft.textContent = 'Ready'; }, 2000);
      })
      .catch(err => {
        statusLeft.textContent = 'Load failed!';
        alert('Error loading files: ' + err.message);
      });
  });

  // Initial welcome file
  addFile('index.html');
  files['index.html'].content = "<!-- Start coding here -->\n<div>Hello world!</div>";
  openFile('index.html');

  updateStatusBar();
</script>

</body>
</html>