<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Web Code Editor</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; font-family: monospace; }
    body { display: flex; height: 100vh; background: #1e1e1e; color: white; }
    #sidebar {
      width: 220px; background: #252526; padding: 10px; border-right: 1px solid #333;
    }
    #file-list button {
      background: none; border: none; color: white; width: 100%; text-align: left;
      padding: 5px; cursor: pointer;
    }
    #editor-container {
      flex: 1; display: flex; flex-direction: column;
    }
    #tabs {
      display: flex; background: #333; border-bottom: 1px solid #444;
    }
    .tab {
      padding: 8px 12px; border-right: 1px solid #444; cursor: pointer;
    }
    .tab.active { background: #1e1e1e; }
    #code-editor {
      flex: 1; background: #1e1e1e; color: #d4d4d4;
      padding: 10px; font-size: 14px; line-height: 1.5;
      outline: none; border: none; resize: none; width: 100%;
    }
    #controls {
      background: #252526; padding: 5px; display: flex; gap: 10px;
    }
    button {
      background: #007acc; color: white; border: none;
      padding: 5px 10px; cursor: pointer;
    }
    #save-load-container {
      margin-top: 10px;
    }
    input[type="text"] {
      width: 100%;
      padding: 5px;
      background: #333;
      color: white;
      border: 1px solid #444;
      margin-top: 5px;
    }
  </style>
</head>
<body>

<div id="sidebar">
  <div id="file-list"></div>
  <div id="save-load-container">
    <button id="btn-new-file">New File</button>
    <button id="btn-save">Save</button>
    <button id="btn-load">Load</button>
    <button id="btn-save-remote">Remote Save</button>
    <button id="btn-load-remote">Remote Load</button>
    <input type="text" id="remote-code" placeholder="Remote Code" />
    <button onclick="insertTab()">Insert Tab</button>
    <button onclick="insertNewline()">Insert Newline</button>
  </div>
</div>

<div id="editor-container">
  <div id="tabs"></div>
  <textarea id="code-editor" spellcheck="false"></textarea>
</div>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/12.0.0/firebase-database-compat.js"></script>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyAoxqdpodVXzfKoWoQ9fj_RPP2CUKLDWNA",
    authDomain: "code-runner-ae31e.firebaseapp.com",
    databaseURL: "https://code-runner-ae31e-default-rtdb.firebaseio.com",
    projectId: "code-runner-ae31e",
    storageBucket: "code-runner-ae31e.appspot.com",
    messagingSenderId: "861242871707",
    appId: "1:861242871707:web:83f027c2dfc5d1044edb3e",
    measurementId: "G-D7SZZ6QKWM"
  };

  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  const codeEditor = document.getElementById('code-editor');
  const fileList = document.getElementById('file-list');
  const tabs = document.getElementById('tabs');
  const remoteCodeInput = document.getElementById('remote-code');

  let files = { "index.html": { content: "" } };
  let openTabs = ["index.html"];
  let activeFile = "index.html";

  function renderFileList() {
    fileList.innerHTML = '';
    for (let filename in files) {
      const btn = document.createElement('button');
      btn.textContent = filename;
      btn.onclick = () => openFile(filename);
      fileList.appendChild(btn);
    }
  }

  function renderTabs() {
    tabs.innerHTML = '';
    for (let filename of openTabs) {
      const tab = document.createElement('div');
      tab.className = 'tab' + (filename === activeFile ? ' active' : '');
      tab.textContent = filename;
      tab.onclick = () => openFile(filename);
      tabs.appendChild(tab);
    }
  }

  function openFile(filename) {
    if (!files[filename]) files[filename] = { content: "" };
    activeFile = filename;
    codeEditor.value = files[filename].content;
    renderTabs();
  }

  document.getElementById('btn-new-file').onclick = () => {
    const filename = prompt("File name?");
    if (!filename || files[filename]) return;
    files[filename] = { content: "" };
    openTabs.push(filename);
    openFile(filename);
    renderFileList();
  };

  document.getElementById('btn-save').onclick = () => {
    if (activeFile) files[activeFile].content = codeEditor.value;
    db.ref("files").set(files).then(() => alert("Saved!"));
  };

  document.getElementById('btn-load').onclick = () => {
    db.ref("files").once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return alert("No saved files");
      files = data;
      openTabs = Object.keys(data);
      openFile(openTabs[0]);
      renderFileList();
    });
  };

  document.getElementById('btn-save-remote').onclick = () => {
    if (activeFile) files[activeFile].content = codeEditor.value;
    const code = remoteCodeInput.value.trim();
    if (!code) return alert("Enter a remote code");
    db.ref("remotes/" + code + "/files").set(files)
      .then(() => alert("Saved remotely!"))
      .catch(err => alert("Error saving: " + err.message));
  };

  document.getElementById('btn-load-remote').onclick = () => {
    const code = remoteCodeInput.value.trim();
    if (!code) return alert("Enter a remote code");
    db.ref("remotes/" + code + "/files").once("value").then(snapshot => {
      const data = snapshot.val();
      if (!data) return alert("No saved files");
      files = data;
      openTabs = Object.keys(data);
      openFile(openTabs[0]);
      renderFileList();
    });
  };

  codeEditor.addEventListener('input', () => {
    if (activeFile) files[activeFile].content = codeEditor.value;
  });

  function insertTab() {
    const start = codeEditor.selectionStart;
    const end = codeEditor.selectionEnd;
    codeEditor.setRangeText("\t", start, end, "end");
  }

  function insertNewline() {
    const start = codeEditor.selectionStart;
    const end = codeEditor.selectionEnd;
    codeEditor.setRangeText("\n", start, end, "end");
  }

  // Initial setup
  openFile("index.html");
  renderFileList();
</script>

</body>
</html>