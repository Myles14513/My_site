<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>VS Code Web Clone with Monaco & Full UI</title>

<!-- VS Code font -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet" />

<!-- Monaco Editor CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs/loader.min.js"></script>

<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    font-family: 'Fira Code', Consolas, monospace, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: #cccccc;
    user-select: none;
    overflow: hidden;
  }

  /* Layout */
  #app {
    display: flex;
    height: 100vh;
    width: 100vw;
    position: relative;
  }

  /* Sidebar (left icons only) */
  #sidebar {
    width: 48px;
    background-color: #252526;
    border-right: 1px solid #333333;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
    z-index: 1001; /* Above overlay */
  }

  #sidebar button {
    width: 40px;
    height: 40px;
    margin: 6px 0;
    background: transparent;
    border: none;
    color: #cccccc;
    font-size: 24px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    position: relative;
  }
  #sidebar button:hover {
    background-color: #333333;
    color: white;
  }
  #sidebar button.active {
    background-color: #007acc;
    color: white;
  }
  /* Tooltip on hover */
  #sidebar button[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 48px;
    top: 50%;
    transform: translateY(-50%);
    background: #333;
    color: #fff;
    padding: 4px 8px;
    border-radius: 2px;
    white-space: nowrap;
    font-size: 12px;
    pointer-events: none;
    user-select: none;
    z-index: 999;
  }

  /* Panels container overlay */
  #panels {
    position: fixed;
    top: 0;
    left: 48px; /* Next to sidebar */
    height: 100vh;
    width: 280px;
    background-color: #1e1e1e;
    border-left: 1px solid #333333;
    box-shadow: 3px 0 12px rgba(0,0,0,0.8);
    overflow-y: auto;
    transition: transform 0.25s ease;
    z-index: 1000;
    transform: translateX(-100%);
  }

  #panels.active {
    transform: translateX(0);
  }

  /* Overlay background behind panels */
  #overlay {
    position: fixed;
    top: 0; left: 0;
    width: 100vw; height: 100vh;
    background: rgba(0,0,0,0.5);
    z-index: 999;
    display: none;
  }
  #overlay.active {
    display: block;
  }

  .panel {
    padding: 12px;
    font-size: 14px;
    color: #cccccc;
  }

  .panel header {
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.05em;
    margin-bottom: 12px;
    user-select: none;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  /* Close button in panel header */
  .panel header button.close-panel {
    background: transparent;
    border: none;
    color: #ccc;
    font-size: 18px;
    cursor: pointer;
    padding: 0;
    line-height: 1;
  }
  .panel header button.close-panel:hover {
    color: #e81123;
  }

  /* File Explorer list */
  #file-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #file-list li {
    padding: 6px 10px;
    border-radius: 3px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #cccccc;
  }
  #file-list li:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  #file-list li.active {
    background-color: #007acc;
    color: white;
    font-weight: 600;
  }
  #file-list li button.delete-btn {
    background: none;
    border: none;
    color: #888888;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
  }
  #file-list li button.delete-btn:hover {
    color: #e81123;
  }

  /* New file input and button */
  #new-file-container {
    display: flex;
    margin-top: 12px;
    gap: 8px;
  }
  #new-file-name {
    flex-grow: 1;
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #cccccc;
    font-size: 14px;
    outline: none;
  }
  #new-file-name::placeholder {
    color: #777777;
  }
  #btn-new-file {
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-new-file:hover {
    background-color: #005f9e;
  }

  /* Search panel */
  #search-input {
    width: 100%;
    padding: 6px 8px;
    border-radius: 3px;
    border: 1px solid #333333;
    background-color: #252526;
    color: #ccc;
    font-size: 14px;
    outline: none;
  }
  #search-results {
    list-style: none;
    margin: 8px 0 0 0;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
  }
  #search-results li {
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 3px;
    font-size: 13px;
    color: #ccc;
  }
  #search-results li:hover {
    background-color: #333333;
    color: white;
  }

  /* Run panel */
  #btn-run-code {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 8px;
    font-size: 14px;
  }
  #btn-run-code:hover {
    background-color: #005f9e;
  }
  #run-iframe {
    width: 100%;
    height: 300px;
    border: 1px solid #333333;
    border-radius: 4px;
    background: white;
  }

  /* Extensions and Settings panel placeholder */
  #extension-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #extension-list li {
    padding: 8px;
    border-radius: 3px;
    cursor: pointer;
    border: 1px solid #333333;
    margin-bottom: 6px;
  }
  #extension-list li:hover {
    background-color: #333333;
    color: white;
  }
  #settings-form label {
    display: block;
    margin-bottom: 10px;
    font-size: 14px;
  }
  #settings-form select, #settings-form input {
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #ccc;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
    outline: none;
  }
  #btn-reset-settings {
    margin-top: 12px;
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-reset-settings:hover {
    background-color: #005f9e;
  }

  /* Main content area */
  #main-area {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
    /* Fill entire width minus sidebar width */
    width: calc(100vw - 48px);
    height: 100vh;
  }

  /* Tabs */
  #tab-bar {
    height: 36px;
    background-color: #252526;
    display: flex;
    align-items: center;
    overflow-x: auto;
    border-bottom: 1px solid #333333;
    user-select: none;
  }
  #tab-bar::-webkit-scrollbar {
    height: 8px;
  }
  #tab-bar::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
  }
  .tab {
    padding: 6px 14px;
    margin: 0 2px;
    font-size: 14px;
    color: #cccccc;
    background-color: #252526;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  .tab.active {
    background-color: #1e1e1e;
    color: white;
    border-bottom: 2px solid #007acc;
  }
  .tab:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  .tab .close-btn {
    margin-left: 10px;
    font-weight: bold;
    color: #888888;
    cursor: pointer;
  }
  .tab .close-btn:hover {
    color: #e81123;
  }

  /* Monaco editor container */
  #editor-container {
    flex-grow: 1;
    position: relative;
  }
  #editor {
    width: 100%;
    height: 100%;
  }

  /* Status bar */
  #status-bar {
    height: 24px;
    background-color: #007acc;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    padding: 0 12px;
    user-select: none;
  }

  /* Hide PS5 buttons as requested */
  #ps5-buttons {
    display: none !important;
  }

  /* Responsive tweaks */
  @media (max-width: 600px) {
    #panels {
      width: 80vw;
      left: 48px;
    }
    #main-area {
      width: calc(100vw - 48px);
    }
  }
</style>
</head>
<body>

<div id="app" role="main">

  <nav id="sidebar" aria-label="Sidebar">
    <button id="btn-explorer" class="active" data-tooltip="Explorer" aria-pressed="true" aria-label="Explorer">üìÅ</button>
    <button id="btn-search" data-tooltip="Search" aria-pressed="false" aria-label="Search">üîç</button>
    <button id="btn-run" data-tooltip="Run and Debug" aria-pressed="false" aria-label="Run and Debug">‚ñ∂Ô∏è</button>
    <button id="btn-extensions" data-tooltip="Extensions" aria-pressed="false" aria-label="Extensions">üß©</button>
    <button id="btn-settings" data-tooltip="Settings" aria-pressed="false" aria-label="Settings">‚öôÔ∏è</button>
  </nav>

  <!-- Overlay behind panels for click to close -->
  <div id="overlay" aria-hidden="true"></div>

  <section id="panels" aria-label="Panels" tabindex="-1">
    <!-- Explorer -->
    <section id="panel-explorer" class="panel" role="region" aria-label="Explorer Panel" hidden>
      <header>
        EXPLORER
        <button class="close-panel" aria-label="Close Explorer Panel">&times;</button>
      </header>
      <ul id="file-list" role="list" aria-label="Files"></ul>
      <div id="new-file-container">
        <input type="text" id="new-file-name" placeholder="New file name..." aria-label="New file name" />
        <button id="btn-new-file" aria-label="Add new file">Add</button>
      </div>
    </section>

    <!-- Search -->
    <section id="panel-search" class="panel" role="region" aria-label="Search Panel" hidden>
      <header>
        SEARCH
        <button class="close-panel" aria-label="Close Search Panel">&times;</button>
      </header>
      <input id="search-input" type="search" placeholder="Search in files..." aria-label="Search in files" />
      <ul id="search-results" role="list" aria-label="Search Results"></ul>
    </section>

    <!-- Run -->
    <section id="panel-run" class="panel" role="region" aria-label="Run and Debug Panel" hidden>
      <header>
        RUN AND DEBUG
        <button class="close-panel" aria-label="Close Run Panel">&times;</button>
      </header>
      <button id="btn-run-code" aria-label="Run code">Run Code</button>
      <iframe id="run-iframe" sandbox="allow-scripts allow-same-origin" title="Run code output"></iframe>
    </section>

    <!-- Extensions -->
    <section id="panel-extensions" class="panel" role="region" aria-label="Extensions Panel" hidden>
      <header>
        EXTENSIONS
        <button class="close-panel" aria-label="Close Extensions Panel">&times;</button>
      </header>
      <ul id="extension-list">
        <li>Extension Marketplace (Coming Soon)</li>
      </ul>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="panel" role="region" aria-label="Settings Panel" hidden>
      <header>
        SETTINGS
        <button class="close-panel" aria-label="Close Settings Panel">&times;</button>
      </header>
      <form id="settings-form">
        <label for="setting-theme">Theme:
          <select id="setting-theme" name="setting-theme" aria-label="Select theme">
            <option value="vs-dark" selected>Dark</option>
            <option value="vs-light">Light</option>
          </select>
        </label>
        <label for="setting-fontsize">Font Size:
          <input type="number" id="setting-fontsize" name="setting-fontsize" min="8" max="40" step="1" value="14" aria-label="Editor font size" />
        </label>
        <button type="button" id="btn-reset-settings">Reset Settings</button>
      </form>
    </section>
  </section>

  <main id="main-area" aria-label="Main editor area">
    <div id="tab-bar" role="tablist" aria-label="Open Files Tabs"></div>
    <div id="editor-container">
      <div id="editor" aria-label="Code Editor"></div>
    </div>
    <footer id="status-bar" role="contentinfo" aria-live="polite">
      <span id="status-message">Ready</span>
      <span id="status-position">Ln 1, Col 1</span>
    </footer>
  </main>
</div>

<script>
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    const state = {
      files: {
        'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Page</title>
</head>
<body>
  <h1>Hello World</h1>
</body>
</html>`,
        'style.css': `body { background-color: #121212; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }`,
        'script.js': `console.log('Hello from JS!');`
      },
      openTabs: ['index.html'],
      activeFile: 'index.html',
      unsavedFiles: new Set(),
      currentPanel: null,
      settings: {
        theme: 'vs-dark',
        fontSize: 14,
      },
    };

    // Elements
    const sidebarButtons = document.querySelectorAll('#sidebar button');
    const panels = {
      explorer: document.getElementById('panel-explorer'),
      search: document.getElementById('panel-search'),
      run: document.getElementById('panel-run'),
      extensions: document.getElementById('panel-extensions'),
      settings: document.getElementById('panel-settings'),
    };
    const overlay = document.getElementById('overlay');

    const fileList = document.getElementById('file-list');
    const newFileNameInput = document.getElementById('new-file-name');
    const btnNewFile = document.getElementById('btn-new-file');

    const tabBar = document.getElementById('tab-bar');
    const statusMessage = document.getElementById('status-message');
    const statusPosition = document.getElementById('status-position');

    const btnRunCode = document.getElementById('btn-run-code');
    const runIframe = document.getElementById('run-iframe');

    const settingThemeSelect = document.getElementById('setting-theme');
    const settingFontSizeInput = document.getElementById('setting-fontsize');
    const btnResetSettings = document.getElementById('btn-reset-settings');

    // Monaco editor instance
    let editor;

    function updateFileList() {
      fileList.innerHTML = '';
      Object.keys(state.files).forEach(fileName => {
        const li = document.createElement('li');
        li.textContent = fileName;
        li.tabIndex = 0;
        li.setAttribute('role', 'listitem');
        if (fileName === state.activeFile) {
          li.classList.add('active');
        }
        // Delete button
        const delBtn = document.createElement('button');
        delBtn.textContent = '√ó';
        delBtn.className = 'delete-btn';
        delBtn.title = `Delete ${fileName}`;
        delBtn.onclick = (e) => {
          e.stopPropagation();
          if (confirm(`Delete file "${fileName}"?`)) {
            delete state.files[fileName];
            if (state.activeFile === fileName) {
              // Switch to another file or create new
              const keys = Object.keys(state.files);
              if (keys.length) {
                openFile(keys[0]);
              } else {
                addNewFile('index.html');
              }
            }
            updateFileList();
            updateTabs();
          }
        };
        li.appendChild(delBtn);

        li.onclick = () => openFile(fileName);
        li.onkeydown = (e) => { if(e.key === 'Enter' || e.key === ' ') openFile(fileName); };

        fileList.appendChild(li);
      });
    }

    function addNewFile(fileName) {
      if (!fileName) {
        alert('Please enter a file name.');
        return;
      }
      if (state.files[fileName]) {
        alert('File already exists.');
        return;
      }
      state.files[fileName] = '';
      openFile(fileName);
      updateFileList();
      updateTabs();
      newFileNameInput.value = '';
    }

    btnNewFile.onclick = () => addNewFile(newFileNameInput.value.trim());

    function openFile(fileName) {
      if (!state.files[fileName]) return;
      if (!state.openTabs.includes(fileName)) {
        state.openTabs.push(fileName);
      }
      state.activeFile = fileName;
      updateTabs();
      updateEditorContent();
    }

    function updateTabs() {
      tabBar.innerHTML = '';
      state.openTabs.forEach(fileName => {
        const tab = document.createElement('div');
        tab.className = 'tab';
        if (fileName === state.activeFile) tab.classList.add('active');
        tab.setAttribute('role', 'tab');
        tab.setAttribute('tabindex', '0');
        tab.textContent = fileName;

        // Close button
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-btn';
        closeBtn.textContent = '√ó';
        closeBtn.title = `Close ${fileName}`;
        closeBtn.onclick = (e) => {
          e.stopPropagation();
          closeTab(fileName);
        };
        tab.appendChild(closeBtn);

        tab.onclick = () => openFile(fileName);
        tab.onkeydown = (e) => { if (e.key === 'Enter' || e.key === ' ') openFile(fileName); };

        tabBar.appendChild(tab);
      });
    }

    function closeTab(fileName) {
      const idx = state.openTabs.indexOf(fileName);
      if (idx === -1) return;
      if (state.unsavedFiles.has(fileName)) {
        if (!confirm(`You have unsaved changes in "${fileName}". Close anyway?`)) return;
      }
      state.openTabs.splice(idx, 1);
      state.unsavedFiles.delete(fileName);
      if (state.activeFile === fileName) {
        if (state.openTabs.length) {
          openFile(state.openTabs[Math.max(0, idx - 1)]);
        } else {
          addNewFile('index.html');
        }
      } else {
        updateTabs();
      }
    }

    function updateEditorContent() {
      if (!editor) return;
      editor.setValue(state.files[state.activeFile] || '');
      editor.setModelLanguage(editor.getModel(), getLanguageFromFile(state.activeFile));
      editor.focus();
      updateStatus();
    }

    // Guess language from file extension
    function getLanguageFromFile(fileName) {
      const ext = fileName.split('.').pop().toLowerCase();
      switch (ext) {
        case 'js': return 'javascript';
        case 'ts': return 'typescript';
        case 'json': return 'json';
        case 'css': return 'css';
        case 'html':
        case 'htm': return 'html';
        case 'py': return 'python';
        case 'java': return 'java';
        case 'c': return 'c';
        case 'cpp':
        case 'cc': return 'cpp';
        case 'cs': return 'csharp';
        case 'md': return 'markdown';
        default: return 'plaintext';
      }
    }

    function saveCurrentFile() {
      if (!editor) return;
      state.files[state.activeFile] = editor.getValue();
      state.unsavedFiles.delete(state.activeFile);
      updateTabs();
      statusMessage.textContent = `Saved "${state.activeFile}"`;
    }

    // Update status bar info
    function updateStatus() {
      if (!editor) return;
      const pos = editor.getPosition();
      statusPosition.textContent = `Ln ${pos.lineNumber}, Col ${pos.column}`;
    }

    // Handle editor changes
    function onEditorChange() {
      if (!editor) return;
      const currentContent = editor.getValue();
      if (state.files[state.activeFile] !== currentContent) {
        state.unsavedFiles.add(state.activeFile);
      } else {
        state.unsavedFiles.delete(state.activeFile);
      }
      updateTabs();
      updateStatus();
    }

    // Setup Monaco editor
    editor = monaco.editor.create(document.getElementById('editor'), {
      value: state.files[state.activeFile],
      language: getLanguageFromFile(state.activeFile),
      theme: state.settings.theme,
      fontSize: state.settings.fontSize,
      automaticLayout: true,
      minimap: { enabled: false },
      scrollbar: {
        verticalScrollbarSize: 10,
        horizontalScrollbarSize: 10
      }
    });

    editor.onDidChangeModelContent(() => {
      onEditorChange();
    });
    editor.onDidChangeCursorPosition(() => {
      updateStatus();
    });

    // Save with Ctrl+S or Cmd+S
    window.addEventListener('keydown', (e) => {
      if ((e.ctrlKey || e.metaKey) && e.key.toLowerCase() === 's') {
        e.preventDefault();
        saveCurrentFile();
      }
    });

    // Panel toggle logic
    function openPanel(name) {
      if (state.currentPanel === name) {
        closePanel();
        return;
      }
      state.currentPanel = name;
      Object.keys(panels).forEach(key => {
        if (key === name) {
          panels[key].hidden = false;
          panels[key].parentElement.classList.add('active');
          panels[key].querySelector('header').focus();
          overlay.classList.add('active');
        } else {
          panels[key].hidden = true;
        }
      });
      updateSidebarButtons();
    }
    function closePanel() {
      state.currentPanel = null;
      Object.values(panels).forEach(panel => panel.hidden = true);
      document.getElementById('panels').classList.remove('active');
      overlay.classList.remove('active');
      updateSidebarButtons();
    }
    function updateSidebarButtons() {
      sidebarButtons.forEach(btn => {
        btn.classList.toggle('active', btn.id === 'btn-' + state.currentPanel);
        btn.setAttribute('aria-pressed', btn.classList.contains('active'));
      });
      document.getElementById('panels').classList.toggle('active', !!state.currentPanel);
    }

    sidebarButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const panelName = btn.id.replace('btn-', '');
        openPanel(panelName);
      });
    });

    // Close panel on overlay click
    overlay.addEventListener('click', () => {
      closePanel();
    });

    // Close panel close buttons
    Object.values(panels).forEach(panel => {
      const closeBtn = panel.querySelector('button.close-panel');
      if (closeBtn) {
        closeBtn.addEventListener('click', () => {
          closePanel();
          sidebarButtons.forEach(b => b.classList.remove('active'));
          sidebarButtons.forEach(b => b.setAttribute('aria-pressed', 'false'));
        });
      }
    });

    // New file enter key support
    newFileNameInput.addEventListener('keydown', (e) => {
      if (e.key === 'Enter') {
        addNewFile(newFileNameInput.value.trim());
      }
    });

    // Run code button
    btnRunCode.addEventListener('click', () => {
      saveCurrentFile();
      if (state.files['index.html']) {
        const html = state.files['index.html'];
        runIframe.srcdoc = html;
      } else {
        runIframe.srcdoc = '<p>No index.html found</p>';
      }
    });

    // Settings form
    settingThemeSelect.addEventListener('change', (e) => {
      state.settings.theme = e.target.value;
      monaco.editor.setTheme(state.settings.theme);
    });
    settingFontSizeInput.addEventListener('input', (e) => {
      const val = parseInt(e.target.value, 10);
      if (val >= 8 && val <= 40) {
        state.settings.fontSize = val;
        editor.updateOptions({ fontSize: val });
      }
    });
    btnResetSettings.addEventListener('click', () => {
      state.settings = { theme: 'vs-dark', fontSize: 14 };
      settingThemeSelect.value = 'vs-dark';
      settingFontSizeInput.value = 14;
      monaco.editor.setTheme('vs-dark');
      editor.updateOptions({ fontSize: 14 });
    });

    // Open default file on load
    openFile(state.activeFile);
  });
</script>

</body>
</html>