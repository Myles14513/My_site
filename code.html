<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>VS Code Web Clone with Monaco & Full UI</title>

<!-- PWA Manifest -->
<link rel="manifest" href="manifest.json" />

<!-- iOS Meta tags for standalone mode -->
<meta name="apple-mobile-web-app-capable" content="yes" />
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
<meta name="apple-mobile-web-app-title" content="VSCodeClone" />
<link rel="apple-touch-icon" href="icons/icon-192.png" />

<!-- VS Code font -->
<link href="https://fonts.googleapis.com/css2?family=Fira+Code&display=swap" rel="stylesheet" />

<!-- Monaco Editor CDN -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs/loader.min.js"></script>

<style>
  /* Reset and base */
  * {
    box-sizing: border-box;
  }
  html, body {
    margin: 0; padding: 0; height: 100%; width: 100%;
    font-family: 'Fira Code', Consolas, monospace, 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: #1e1e1e;
    color: #cccccc;
    user-select: none;
    overflow: hidden;
    -webkit-tap-highlight-color: transparent;
    -webkit-user-select: text; /* enable text selection on mobile */
  }

  /* Layout */
  #app {
    display: flex;
    height: 100vh;
    width: 100vw;
  }

  /* Sidebar (left) */
  #sidebar {
    width: 48px;
    background-color: #252526;
    border-right: 1px solid #333333;
    display: flex;
    flex-direction: column;
    align-items: center;
    padding: 8px 0;
  }

  #sidebar button {
    width: 40px;
    height: 40px;
    margin: 6px 0;
    background: transparent;
    border: none;
    color: #cccccc;
    font-size: 24px;
    cursor: pointer;
    border-radius: 4px;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background-color 0.2s ease-in-out, color 0.2s ease-in-out;
    position: relative;
    -webkit-tap-highlight-color: transparent;
  }
  #sidebar button:hover {
    background-color: #333333;
    color: white;
  }
  #sidebar button.active {
    background-color: #007acc;
    color: white;
  }
  /* Tooltip on hover */
  #sidebar button[data-tooltip]:hover::after {
    content: attr(data-tooltip);
    position: absolute;
    left: 48px;
    top: 50%;
    transform: translateY(-50%);
    background: #333;
    color: #fff;
    padding: 4px 8px;
    border-radius: 2px;
    white-space: nowrap;
    font-size: 12px;
    pointer-events: none;
    user-select: none;
    z-index: 999;
  }

  /* Panels container (right of sidebar) */
  #panels {
    width: 280px;
    background-color: #1e1e1e;
    border-right: 1px solid #333333;
    display: flex;
    flex-direction: column;
  }

  .panel {
    flex-grow: 1;
    display: none;
    overflow-y: auto;
    padding: 12px;
    font-size: 14px;
  }
  .panel.active {
    display: block;
  }

  .panel header {
    font-weight: 700;
    font-size: 13px;
    letter-spacing: 0.05em;
    color: #cccccc;
    margin-bottom: 12px;
    user-select: none;
  }

  /* File Explorer list */
  #file-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #file-list li {
    padding: 6px 10px;
    border-radius: 3px;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
    color: #cccccc;
  }
  #file-list li:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  #file-list li.active {
    background-color: #007acc;
    color: white;
    font-weight: 600;
  }
  #file-list li button.delete-btn {
    background: none;
    border: none;
    color: #888888;
    font-weight: bold;
    cursor: pointer;
    font-size: 14px;
    user-select: none;
  }
  #file-list li button.delete-btn:hover {
    color: #e81123;
  }

  /* New file input and button */
  #new-file-container {
    display: flex;
    margin-top: 12px;
    gap: 8px;
  }
  #new-file-name {
    flex-grow: 1;
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #cccccc;
    font-size: 14px;
    outline: none;
    -webkit-appearance: none;
  }
  #new-file-name::placeholder {
    color: #777777;
  }
  #btn-new-file {
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-new-file:hover {
    background-color: #005f9e;
  }

  /* Search panel */
  #search-input {
    width: 100%;
    padding: 6px 8px;
    border-radius: 3px;
    border: 1px solid #333333;
    background-color: #252526;
    color: #ccc;
    font-size: 14px;
    outline: none;
  }
  #search-results {
    list-style: none;
    margin: 8px 0 0 0;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
  }
  #search-results li {
    padding: 6px 8px;
    cursor: pointer;
    border-radius: 3px;
    font-size: 13px;
    color: #ccc;
  }
  #search-results li:hover {
    background-color: #333333;
    color: white;
  }

  /* Run panel */
  #btn-run-code {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 6px 14px;
    border-radius: 3px;
    cursor: pointer;
    margin-bottom: 8px;
    font-size: 14px;
  }
  #btn-run-code:hover {
    background-color: #005f9e;
  }
  #run-iframe {
    width: 100%;
    height: 300px;
    border: 1px solid #333333;
    border-radius: 4px;
    background: white;
  }

  /* Extensions and Settings panel placeholder */
  #extension-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }
  #extension-list li {
    padding: 8px;
    border-radius: 3px;
    cursor: pointer;
    border: 1px solid #333333;
    margin-bottom: 6px;
  }
  #extension-list li:hover {
    background-color: #333333;
    color: white;
  }
  #settings-form label {
    display: block;
    margin-bottom: 10px;
    font-size: 14px;
  }
  #settings-form select, #settings-form input {
    background: #252526;
    border: 1px solid #333333;
    border-radius: 3px;
    padding: 6px 8px;
    color: #ccc;
    font-size: 14px;
    width: 100%;
    box-sizing: border-box;
    outline: none;
  }
  #btn-reset-settings {
    margin-top: 12px;
    background-color: #007acc;
    border: none;
    color: white;
    cursor: pointer;
    padding: 6px 14px;
    border-radius: 3px;
    font-size: 14px;
    transition: background-color 0.15s ease-in-out;
  }
  #btn-reset-settings:hover {
    background-color: #005f9e;
  }

  /* Main content area */
  #main-area {
    flex-grow: 1;
    display: flex;
    flex-direction: column;
  }

  /* Tabs */
  #tab-bar {
    height: 36px;
    background-color: #252526;
    display: flex;
    align-items: center;
    overflow-x: auto;
    border-bottom: 1px solid #333333;
  }
  #tab-bar::-webkit-scrollbar {
    height: 8px;
  }
  #tab-bar::-webkit-scrollbar-thumb {
    background: #555;
    border-radius: 4px;
  }
  .tab {
    user-select: none;
    padding: 6px 14px;
    margin: 0 2px;
    font-size: 14px;
    color: #cccccc;
    background-color: #252526;
    border-top-left-radius: 4px;
    border-top-right-radius: 4px;
    cursor: pointer;
    display: flex;
    align-items: center;
  }
  .tab.active {
    background-color: #1e1e1e;
    color: white;
    border-bottom: 2px solid #007acc;
  }
  .tab:hover:not(.active) {
    background-color: #333333;
    color: white;
  }
  .tab .close-btn {
    margin-left: 10px;
    font-weight: bold;
    color: #888888;
    cursor: pointer;
  }
  .tab .close-btn:hover {
    color: #e81123;
  }

  /* Monaco editor container */
  #editor-container {
    flex-grow: 1;
    position: relative;
  }
  #editor {
    width: 100%;
    height: 100%;
  }

  /* Status bar */
  #status-bar {
    height: 24px;
    background-color: #007acc;
    color: white;
    display: flex;
    justify-content: space-between;
    align-items: center;
    font-size: 13px;
    padding: 0 12px;
    user-select: none;
  }

  /* PS5 insert buttons */
  #ps5-buttons {
    position: absolute;
    bottom: 36px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: 6px;
    z-index: 10;
  }
  #ps5-buttons button {
    background-color: #007acc;
    border: none;
    color: white;
    padding: 8px 16px;
    border-radius: 4px;
    font-size: 14px;
    cursor: pointer;
    user-select: none;
    transition: background-color 0.15s ease-in-out;
  }
  #ps5-buttons button:hover {
    background-color: #005f9e;
  }

  /* Mobile optimizations */
  @media (max-width: 600px) {
    #sidebar {
      width: 48px;
    }
    #panels {
      display: none;
    }
    #main-area {
      flex-grow: 1;
    }
    #tab-bar {
      overflow-x: scroll;
    }
    #sidebar button {
      width: 48px;
      height: 48px;
      font-size: 28px;
    }
    #ps5-buttons button {
      padding: 12px 20px;
      font-size: 18px;
    }
  }
</style>
</head>
<body>

<div id="app" role="main">

  <nav id="sidebar" aria-label="Sidebar">
    <button id="btn-explorer" class="active" data-tooltip="Explorer" aria-pressed="true" aria-label="Explorer">üìÅ</button>
    <button id="btn-search" data-tooltip="Search" aria-pressed="false" aria-label="Search">üîç</button>
    <button id="btn-run" data-tooltip="Run and Debug" aria-pressed="false" aria-label="Run and Debug">‚ñ∂Ô∏è</button>
    <button id="btn-extensions" data-tooltip="Extensions" aria-pressed="false" aria-label="Extensions">üß©</button>
    <button id="btn-settings" data-tooltip="Settings" aria-pressed="false" aria-label="Settings">‚öôÔ∏è</button>
  </nav>

  <section id="panels" aria-label="Panels">
    <!-- Explorer -->
    <section id="panel-explorer" class="panel active" role="region" aria-label="Explorer Panel">
      <header>EXPLORER</header>
      <ul id="file-list" role="list" aria-label="Files"></ul>
      <div id="new-file-container">
        <input type="text" id="new-file-name" placeholder="New file name..." aria-label="New file name" />
        <button id="btn-new-file" aria-label="Add new file">Add</button>
      </div>
    </section>

    <!-- Search -->
    <section id="panel-search" class="panel" role="region" aria-label="Search Panel">
      <header>SEARCH</header>
      <input id="search-input" type="search" placeholder="Search in files..." aria-label="Search in files" />
      <ul id="search-results" role="list" aria-label="Search Results"></ul>
    </section>

    <!-- Run -->
    <section id="panel-run" class="panel" role="region" aria-label="Run and Debug Panel">
      <header>RUN AND DEBUG</header>
      <button id="btn-run-code" aria-label="Run code">Run Code</button>
      <iframe id="run-iframe" sandbox="allow-scripts allow-same-origin" title="Run code output"></iframe>
    </section>

    <!-- Extensions -->
    <section id="panel-extensions" class="panel" role="region" aria-label="Extensions Panel">
      <header>EXTENSIONS</header>
      <ul id="extension-list">
        <li>Extension Marketplace (Coming Soon)</li>
      </ul>
    </section>

    <!-- Settings -->
    <section id="panel-settings" class="panel" role="region" aria-label="Settings Panel">
      <header>SETTINGS</header>
      <form id="settings-form">
        <label for="setting-theme">Theme:
          <select id="setting-theme" name="setting-theme" aria-label="Select theme">
            <option value="vs-dark" selected>Dark</option>
            <option value="vs-light">Light</option>
          </select>
        </label>
        <label for="setting-fontsize">Font Size:
          <input type="number" id="setting-fontsize" name="setting-fontsize" min="8" max="40" step="1" value="14" aria-label="Editor font size" />
        </label>
        <button type="button" id="btn-reset-settings">Reset Settings</button>
      </form>
    </section>
  </section>

  <main id="main-area" aria-label="Main editor area">
    <div id="tab-bar" role="tablist" aria-label="Open Files Tabs"></div>
    <div id="editor-container">
      <div id="editor" aria-label="Code Editor"></div>
      <div id="ps5-buttons" aria-label="PS5 insert buttons">
        <button id="btn-insert-tab" aria-label="Insert tab">Insert Tab</button>
        <button id="btn-insert-newline" aria-label="Insert newline">Insert Newline</button>
      </div>
    </div>
    <footer id="status-bar" role="contentinfo" aria-live="polite">
      <span id="status-message">Ready</span>
      <span id="status-position">Ln 1, Col 1</span>
    </footer>
  </main>
</div>

<script>
  // Load Monaco Editor with AMD loader
  require.config({ paths: { vs: 'https://cdnjs.cloudflare.com/ajax/libs/monaco-editor/0.40.0/min/vs' }});
  require(['vs/editor/editor.main'], function () {
    // State
    const state = {
      files: {
        'index.html': `<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<title>My Page</title>
</head>
<body>
  <h1>Hello World</h1>
</body>
</html>`,
        'style.css': `body { background-color: #121212; color: white; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }`,
        'script.js': `console.log('Hello from JS!');`
      },
      openTabs: ['index.html'],
      activeFile: 'index.html',
      unsavedFiles: new Set(),
      currentPanel: 'explorer',
      settings: {
        theme: 'vs-dark',
        fontSize: 14
      }
    };

    // DOM Elements
    const fileList = document.getElementById('file-list');
    const tabBar = document.getElementById('tab-bar');
    const editorContainer = document.getElementById('editor');
    const statusMessage = document.getElementById('status-message');
    const statusPosition = document.getElementById('status-position');
    const panels = {
      explorer: document.getElementById('panel-explorer'),
      search: document.getElementById('panel-search'),
      run: document.getElementById('panel-run'),
      extensions: document.getElementById('panel-extensions'),
      settings: document.getElementById('panel-settings')
    };

    // Monaco Editor instance
    let editor = monaco.editor.create(editorContainer, {
      value: state.files[state.activeFile],
      language: getLanguage(state.activeFile),
      theme: state.settings.theme,
      fontSize: state.settings.fontSize,
      automaticLayout: true,
      minimap: { enabled: false }
    });

    // Helpers
    function getLanguage(filename) {
      if (filename.endsWith('.js')) return 'javascript';
      if (filename.endsWith('.ts')) return 'typescript';
      if (filename.endsWith('.json')) return 'json';
      if (filename.endsWith('.css')) return 'css';
      if (filename.endsWith('.html') || filename.endsWith('.htm')) return 'html';
      if (filename.endsWith('.py')) return 'python';
      return 'plaintext';
    }

    function updateFileList() {
      fileList.innerHTML = '';
      for (const file in state.files) {
        const li = document.createElement('li');
        li.textContent = file;
        li.className = (file === state.activeFile) ? 'active' : '';
        li.tabIndex = 0;
        li.setAttribute('role', 'button');
        li.addEventListener('click', () => openFile(file));
        li.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') openFile(file);
        });
        // Delete button
        if (file !== 'index.html') {
          const delBtn = document.createElement('button');
          delBtn.textContent = '√ó';
          delBtn.className = 'delete-btn';
          delBtn.title = 'Delete file';
          delBtn.addEventListener('click', e => {
            e.stopPropagation();
            if (confirm(`Delete ${file}?`)) {
              delete state.files[file];
              if (state.activeFile === file) {
                const files = Object.keys(state.files);
                openFile(files[0]);
              }
              updateFileList();
              updateTabs();
            }
          });
          li.appendChild(delBtn);
        }
        fileList.appendChild(li);
      }
    }

    function updateTabs() {
      tabBar.innerHTML = '';
      state.openTabs.forEach(file => {
        const tab = document.createElement('div');
        tab.className = 'tab' + (file === state.activeFile ? ' active' : '');
        tab.setAttribute('role', 'tab');
        tab.setAttribute('tabindex', 0);
        tab.textContent = file;

        // Close button
        const closeBtn = document.createElement('span');
        closeBtn.className = 'close-btn';
        closeBtn.textContent = '√ó';
        closeBtn.title = 'Close tab';
        closeBtn.addEventListener('click', e => {
          e.stopPropagation();
          closeTab(file);
        });
        tab.appendChild(closeBtn);

        tab.addEventListener('click', () => openFile(file));
        tab.addEventListener('keydown', e => {
          if (e.key === 'Enter' || e.key === ' ') openFile(file);
          if (e.key === 'Delete' || (e.key === 'Backspace' && e.ctrlKey)) closeTab(file);
        });

        tabBar.appendChild(tab);
      });
    }

    function openFile(file) {
      if (!state.files[file]) return;
      if (!state.openTabs.includes(file)) {
        state.openTabs.push(file);
      }
      state.activeFile = file;
      editor.setValue(state.files[file]);
      monaco.editor.setModelLanguage(editor.getModel(), getLanguage(file));
      updateTabs();
      updateFileList();
      updateStatus('Opened ' + file);
    }

    function closeTab(file) {
      const idx = state.openTabs.indexOf(file);
      if (idx === -1) return;
      state.openTabs.splice(idx, 1);
      if (state.activeFile === file) {
        const nextFile = state.openTabs[idx] || state.openTabs[idx - 1];
        if (nextFile) openFile(nextFile);
        else {
          // No tabs open, reset editor
          editor.setValue('');
          state.activeFile = null;
          updateTabs();
          updateFileList();
          updateStatus('No file open');
        }
      } else {
        updateTabs();
      }
    }

    function updateStatus(message) {
      statusMessage.textContent = message;
    }

    // Save editor content on change
    editor.onDidChangeModelContent(() => {
      if (!state.activeFile) return;
      state.files[state.activeFile] = editor.getValue();
      state.unsavedFiles.add(state.activeFile);
      updateStatus('Editing ' + state.activeFile);
      updateTabs();
    });

    // Update cursor position in status bar
    editor.onDidChangeCursorPosition(e => {
      statusPosition.textContent = `Ln ${e.position.lineNumber}, Col ${e.position.column}`;
    });

    // New file creation
    document.getElementById('btn-new-file').addEventListener('click', () => {
      const input = document.getElementById('new-file-name');
      const name = input.value.trim();
      if (!name) return alert('Please enter a file name.');
      if (state.files[name]) return alert('File already exists.');
      state.files[name] = '';
      input.value = '';
      openFile(name);
      updateFileList();
      updateTabs();
    });

    // Sidebar buttons for panels
    document.getElementById('btn-explorer').addEventListener('click', () => switchPanel('explorer'));
    document.getElementById('btn-search').addEventListener('click', () => switchPanel('search'));
    document.getElementById('btn-run').addEventListener('click', () => switchPanel('run'));
    document.getElementById('btn-extensions').addEventListener('click', () => switchPanel('extensions'));
    document.getElementById('btn-settings').addEventListener('click', () => switchPanel('settings'));

    function switchPanel(panel) {
      if (state.currentPanel === panel) return;
      state.currentPanel = panel;
      for (const key in panels) {
        panels[key].classList.toggle('active', key === panel);
      }
      // Update sidebar buttons aria-pressed & active class
      document.querySelectorAll('#sidebar button').forEach(btn => {
        const idMap = {
          'btn-explorer': 'explorer',
          'btn-search': 'search',
          'btn-run': 'run',
          'btn-extensions': 'extensions',
          'btn-settings': 'settings'
        };
        const panelKey = idMap[btn.id];
        const isActive = panelKey === panel;
        btn.classList.toggle('active', isActive);
        btn.setAttribute('aria-pressed', isActive);
      });
    }

    // Run code button - outputs html/js/css from open files (only html/js/css supported)
    document.getElementById('btn-run-code').addEventListener('click', () => {
      // Get current HTML, CSS, JS from files or empty strings
      const html = state.files['index.html'] || '';
      const css = state.files['style.css'] || '';
      const js = state.files['script.js'] || '';

      const source = `
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<style>${css}</style>
</head>
<body>
${html}
<script>${js}<\/script>
</body>
</html>`;
      const iframe = document.getElementById('run-iframe');
      iframe.srcdoc = source;
      updateStatus('Ran code');
    });

    // Settings form: theme and font size
    const settingTheme = document.getElementById('setting-theme');
    const settingFontSize = document.getElementById('setting-fontsize');
    const btnResetSettings = document.getElementById('btn-reset-settings');

    settingTheme.value = state.settings.theme;
    settingFontSize.value = state.settings.fontSize;

    settingTheme.addEventListener('change', () => {
      state.settings.theme = settingTheme.value;
      monaco.editor.setTheme(state.settings.theme);
    });

    settingFontSize.addEventListener('change', () => {
      const val = parseInt(settingFontSize.value, 10);
      if (val >= 8 && val <= 40) {
        state.settings.fontSize = val;
        editor.updateOptions({ fontSize: val });
      }
    });

    btnResetSettings.addEventListener('click', () => {
      state.settings.theme = 'vs-dark';
      state.settings.fontSize = 14;
      settingTheme.value = state.settings.theme;
      settingFontSize.value = state.settings.fontSize;
      monaco.editor.setTheme(state.settings.theme);
      editor.updateOptions({ fontSize: state.settings.fontSize });
    });

    // Insert Tab / Newline buttons (for PS5 & accessibility)
    document.getElementById('btn-insert-tab').addEventListener('click', () => {
      editor.trigger('keyboard', 'type', { text: '\t' });
      editor.focus();
    });
    document.getElementById('btn-insert-newline').addEventListener('click', () => {
      editor.trigger('keyboard', 'type', { text: '\n' });
      editor.focus();
    });

    // Initialize UI
    updateFileList();
    updateTabs();
    openFile(state.activeFile);

  });
</script>

</body>
</html>