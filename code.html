<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Mini VS Code Editor</title>
  <style>
    /* Dark theme UI styling: sidebar, tabs, buttons, editor */
    /* (Use colors akin to VS Code default dark: #1e1e1e sidebar, #252526 tabs, editor background #1e1e1e, highlight blue #0e639c) */
  </style>
</head>
<body>
  <div id="sidebar">
    <h2>Explorer</h2>
    <button id="btn-save">Save (Firebase)</button>
    <button id="btn-run">Run</button>
    <hr>
    <div class="files-section" data-lang="html">
      <h3>HTML Files</h3>
      <input type="text" id="new-file-html" placeholder="Add html file"/>
      <button class="btn-add-file" data-lang="html">➕</button>
      <ul id="file-list-html"></ul>
    </div>
    <!-- similarly CSS and JS -->
  </div>
  <div id="main">
    <div id="tabs">
      <button id="tab-html" class="active">HTML</button>
      <button id="tab-css">CSS</button>
      <button id="tab-js">JS</button>
    </div>
    <div id="editor-container">
      <textarea id="editor-html"></textarea>
      <textarea id="editor-css" style="display:none;"></textarea>
      <textarea id="editor-js" style="display:none;"></textarea>
    </div>
    <div id="controls">
      <button id="btn-tab">Tab</button>
      <button id="btn-newline">Newline</button>
    </div>
    <iframe id="preview"></iframe>
  </div>

  <script>
    // State: files object and current filename per lang
    let files = { html: {}, css: {}, js: {} };
    let currentFile = { html: null, css: null, js: null };
    let currentTab = 'html';

    // Add file, update list UI, switch tabs, insert tab/newline helpers...
    // → similar to your existing code

    // Remote save to Firebase ONLY
    function saveRemote(code) {
      // Build payload for all files
      const payload = { files, currentFile };
      fetch(`https://code-runner-ae31e-default-rtdb.firebaseio.com/snippets/${code}.json`, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      })
      .then(r => {
        if (!r.ok) throw new Error(`HTTP ${r.status}`);
        return r.json();
      })
      .then(_ => alert(`Saved code: ${code}`))
      .catch(err => alert('Save failed: ' + err.message));
    }

    function loadRemote(code) {
      fetch(`https://code-runner-ae31e-default-rtdb.firebaseio.com/snippets/${code}.json`)
        .then(r => {
          if (!r.ok) throw new Error(`HTTP ${r.status}`);
          return r.json();
        })
        .then(data => {
          if (!data || !data.files) throw new Error('No data');
          files = data.files;
          currentFile = data.currentFile;
          updateFileList('html'); updateFileList('css'); updateFileList('js');
          switchTab(currentTab);
          alert('Loaded from Firebase');
        })
        .catch(err => alert('Load failed: ' + err.message));
    }

    document.getElementById('btn-save').onclick = () => {
      const code = prompt('Enter code to save under:');
      if (code) saveRemote(code);
    };

    // Run button builds html+css+js from all files and sets preview.srcdoc

    // Init with one default file per language
    files.html['index.html'] = '<!-- HTML here -->';
    currentFile.html = 'index.html';
    files.css['style.css'] = 'body { color: white; }';
    currentFile.css = 'style.css';
    files.js['script.js'] = '/* JS code here */';
    currentFile.js = 'script.js';
    updateFileList('html'); updateFileList('css'); updateFileList('js');
    switchTab('html');
  </script>
</body>
</html>